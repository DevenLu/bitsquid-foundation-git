# constants

COMPILER = "g++"
EXEC = "unit_test"
FLAGS = "-Wall -Wextra -g"

OBJECTS = %w(unit_test.o memory.o)
HEADERS = %w(array.h collection_types.h memory.h memory_types.h types.h temp_allocator.h)

# tasks

task :build => [EXEC]

task :test => :build do
	sh "./#{EXEC}"
end

task :default => :test

desc "Clean stuff"
task :clean do
	files = (Dir["*.o"] + Dir["#{EXEC}"]).uniq
	rm_f files unless files.empty?
end

# rules

rule '.o' => '.cpp' do |target|
	sh "#{COMPILER} #{FLAGS} -c -o #{target.name} #{target.source}"
end

file EXEC => OBJECTS do
	sh "#{COMPILER} #{FLAGS} #{OBJECTS.join(" ")} -o #{EXEC}"
end

# dependencies

file 'unit_test.o' => %w(unit_test.cpp) + HEADERS
file 'memory.o' => %w(memory.cpp) + %w(types.h memory_types.h memory.h)